import { Component, Input, ChangeDetectionStrategy, ChangeDetectorRef } from '@angular/core';
import { ToastService } from '../toast.service';
import { ToastType } from '../toast-type';
import * as i0 from "@angular/core";
import * as i1 from "../toast.service";
import * as i2 from "../toastify-toast/toastify-toast.component";
import * as i3 from "@angular/common";
export class ToastifyToastContainerComponent {
    constructor(_toastService, _cd) {
        this._toastService = _toastService;
        this._cd = _cd;
        this.transitionDurations = 400;
        this.position = 'top-right';
        this.transition = 'bounce';
        this.autoClose = 5000;
        this.hideProgressBar = false;
        this.pauseOnHover = true;
        this.pauseOnVisibilityChange = true;
        this.closeOnClick = true;
        this.newestOnTop = false;
        this.preventDuplicates = false;
        this.iconLibrary = 'none';
        this.ToastType = ToastType;
        this.toasts = new Array();
        this.toastTransitionDict = {};
    }
    ngOnChanges() {
        this._cd.markForCheck();
    }
    dismiss(toast) {
        this.toastTransitionDict[toast.id] = TransitionState.exiting;
        setTimeout(() => {
            const index = this.toasts.indexOf(toast);
            this.toasts.splice(index, 1);
            this._cd.markForCheck();
        }, this.transitionDurations);
    }
    getClass(toast) {
        let base = `toast toast--${ToastType[toast.type]} `;
        const state = this.toastTransitionDict[toast.id];
        if (state === TransitionState.entering) {
            base += `${this.transition}-enter ${this.transition}-enter--${this.position}`;
        }
        else if (state === TransitionState.exiting) {
            base += `${this.transition}-exit ${this.transition}-exit--${this.position}`;
        }
        return base;
    }
    ngOnInit() {
        this._toastService.dismissAllEvent.subscribe(() => {
            this.toasts = new Array();
            this._cd.markForCheck();
        });
        this._toastService.toastAddedEvent.subscribe((toast) => this.handleToastAddedEvent(toast));
    }
    handleToastAddedEvent(toast) {
        // If "preventDuplicates" is enabled, toast is not added if one toast with same message exists
        // The only thing to do is to update the toast time to keep it visible
        if (this.preventDuplicates === true) {
            const sameToast = this.toasts.find((existingToast) => existingToast.message === toast.message);
            if (sameToast) {
                sameToast.$resetToast.next();
                this._cd.markForCheck();
                return;
            }
        }
        // Add new toast transition
        this.toastTransitionDict[toast.id] = TransitionState.entering;
        setTimeout(() => {
            this.toastTransitionDict[toast.id] = TransitionState.noTransition;
            this._cd.markForCheck();
        }, this.transitionDurations);
        // Add new toast
        if (this.newestOnTop) {
            this.toasts.unshift(toast);
        }
        else {
            this.toasts.push(toast);
        }
        this._cd.markForCheck();
    }
}
/** @nocollapse */ ToastifyToastContainerComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: ToastifyToastContainerComponent, deps: [{ token: i1.ToastService }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
/** @nocollapse */ ToastifyToastContainerComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.0.5", type: ToastifyToastContainerComponent, selector: "lib-toastify-toast-container", inputs: { position: "position", transition: "transition", autoClose: "autoClose", hideProgressBar: "hideProgressBar", pauseOnHover: "pauseOnHover", pauseOnVisibilityChange: "pauseOnVisibilityChange", closeOnClick: "closeOnClick", newestOnTop: "newestOnTop", preventDuplicates: "preventDuplicates", iconLibrary: "iconLibrary" }, usesOnChanges: true, ngImport: i0, template: "<div class=\"toast-container toast-container--{{position}}\">\n    <lib-toastify-toast *ngFor=\"let toast of toasts\" [class]=\"getClass(toast)\" style=\"animation-fill-mode: both; animation-duration: 0.75s\"\n        [autoClose]=\"autoClose\" [toast]=\"toast\" (dismissEvent)=\"dismiss(toast)\" [hideProgressBar]=\"hideProgressBar\" [pauseOnHover]=\"pauseOnHover\"\n        [pauseOnVisibilityChange]=\"pauseOnVisibilityChange\" [closeOnClick]=\"closeOnClick\" [iconLibrary]=\"iconLibrary\">\n    </lib-toastify-toast>\n</div>", styles: [".toast-container{z-index:9999;-webkit-transform:translateZ(9999px);position:fixed;padding:4px;width:320px;box-sizing:border-box;color:#fff}.toast-container--top-left{top:1em;left:1em}.toast-container--top-center{top:1em;left:50%;margin-left:-160px}.toast-container--top-right{top:1em;right:1em}.toast-container--bottom-left{bottom:1em;left:1em}.toast-container--bottom-center{bottom:1em;left:50%;margin-left:-160px}.toast-container--bottom-right{bottom:1em;right:1em}@media only screen and (max-width:480px){.toast-container{width:100vw;padding:0;left:0;margin:0}.toast-container--top-center,.toast-container--top-left,.toast-container--top-right{top:0}.toast-container--bottom-center,.toast-container--bottom-left,.toast-container--bottom-right{bottom:0}.toast-container--rtl{right:0;left:auto}}.toast{position:relative;min-height:64px;box-sizing:border-box;margin-bottom:1rem;padding:8px;border-radius:1px;box-shadow:0 1px 10px 0 rgba(0,0,0,.1),0 2px 15px 0 rgba(0,0,0,.05);display:flex;justify-content:space-between;max-height:800px;overflow:hidden;font-family:sans-serif;cursor:pointer;direction:ltr}.toast--rtl{direction:rtl}.toast--default{background:#fff;color:#aaa}.toast--info{background:#3498db}.toast--success{background:#07bc0c}.toast--warning{background:#f1c40f}.toast--error{background:#e74c3c}.toast-body{margin:auto 0;flex:1}@media only screen and (max-width:480px){.toast{margin-bottom:0}}@keyframes bounceInRight{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(3000px,0,0)}60%{opacity:1;transform:translate3d(-25px,0,0)}75%{transform:translate3d(10px,0,0)}90%{transform:translate3d(-5px,0,0)}to{transform:none}}@keyframes bounceOutRight{20%{opacity:1;transform:translate3d(-20px,0,0)}to{opacity:0;transform:translate3d(2000px,0,0)}}@keyframes bounceInLeft{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(-3000px,0,0)}60%{opacity:1;transform:translate3d(25px,0,0)}75%{transform:translate3d(-10px,0,0)}90%{transform:translate3d(5px,0,0)}to{transform:none}}@keyframes bounceOutLeft{20%{opacity:1;transform:translate3d(20px,0,0)}to{opacity:0;transform:translate3d(-2000px,0,0)}}@keyframes bounceInUp{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,3000px,0)}60%{opacity:1;transform:translate3d(0,-20px,0)}75%{transform:translate3d(0,10px,0)}90%{transform:translate3d(0,-5px,0)}to{transform:translateZ(0)}}@keyframes bounceOutUp{20%{transform:translate3d(0,-10px,0)}40%,45%{opacity:1;transform:translate3d(0,20px,0)}to{opacity:0;transform:translate3d(0,-2000px,0)}}@keyframes bounceInDown{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,-3000px,0)}60%{opacity:1;transform:translate3d(0,25px,0)}75%{transform:translate3d(0,-10px,0)}90%{transform:translate3d(0,5px,0)}to{transform:none}}@keyframes bounceOutDown{20%{transform:translate3d(0,10px,0)}40%,45%{opacity:1;transform:translate3d(0,-20px,0)}to{opacity:0;transform:translate3d(0,2000px,0)}}.bounce-enter--bottom-left,.bounce-enter--top-left{animation-name:bounceInLeft}.bounce-enter--bottom-right,.bounce-enter--top-right{animation-name:bounceInRight}.bounce-enter--top-center{animation-name:bounceInDown}.bounce-enter--bottom-center{animation-name:bounceInUp}.bounce-exit--bottom-left,.bounce-exit--top-left{animation-name:bounceOutLeft}.bounce-exit--bottom-right,.bounce-exit--top-right{animation-name:bounceOutRight}.bounce-exit--top-center{animation-name:bounceOutUp}.bounce-exit--bottom-center{animation-name:bounceOutDown}@keyframes zoomIn{0%{opacity:0;transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes zoomOut{0%{opacity:1}50%{opacity:0;transform:scale3d(.3,.3,.3)}to{opacity:0}}.zoom-enter{animation-name:zoomIn}.zoom-exit{animation-name:zoomOut}@keyframes flipIn{0%{transform:perspective(400px) rotateX(90deg);animation-timing-function:ease-in;opacity:0}40%{transform:perspective(400px) rotateX(-20deg);animation-timing-function:ease-in}60%{transform:perspective(400px) rotateX(10deg);opacity:1}80%{transform:perspective(400px) rotateX(-5deg)}to{transform:perspective(400px)}}@keyframes flipOut{0%{transform:perspective(400px)}30%{transform:perspective(400px) rotateX(-20deg);opacity:1}to{transform:perspective(400px) rotateX(90deg);opacity:0}}.flip-enter{animation-name:flipIn}.flip-exit{animation-name:flipOut}@keyframes slideInRight{0%{transform:translate3d(110%,0,0);visibility:visible}to{transform:translateZ(0)}}@keyframes slideInLeft{0%{transform:translate3d(-110%,0,0);visibility:visible}to{transform:translateZ(0)}}@keyframes slideInUp{0%{transform:translate3d(0,110%,0);visibility:visible}to{transform:translateZ(0)}}@keyframes slideInDown{0%{transform:translate3d(0,-110%,0);visibility:visible}to{transform:translateZ(0)}}@keyframes slideOutRight{0%{transform:translateZ(0)}to{visibility:hidden;transform:translate3d(110%,0,0)}}@keyframes slideOutLeft{0%{transform:translateZ(0)}to{visibility:hidden;transform:translate3d(-110%,0,0)}}@keyframes slideOutDown{0%{transform:translateZ(0)}to{visibility:hidden;transform:translate3d(0,500px,0)}}@keyframes slideOutUp{0%{transform:translateZ(0)}to{visibility:hidden;transform:translate3d(0,-500px,0)}}.slide-enter--bottom-left,.slide-enter--top-left{animation-name:slideInLeft}.slide-enter--bottom-right,.slide-enter--top-right{animation-name:slideInRight}.slide-enter--top-center{animation-name:slideInDown}.slide-enter--bottom-center{animation-name:slideInUp}.slide-exit--bottom-left,.slide-exit--top-left{animation-name:slideOutLeft}.slide-exit--bottom-right,.slide-exit--top-right{animation-name:slideOutRight}.slide-exit--top-center{animation-name:slideOutUp}.slide-exit--bottom-center{animation-name:slideOutDown}"], components: [{ type: i2.ToastifyToastComponent, selector: "lib-toastify-toast", inputs: ["autoClose", "hideProgressBar", "pauseOnHover", "pauseOnVisibilityChange", "closeOnClick", "toast", "iconLibrary"], outputs: ["dismissEvent"] }], directives: [{ type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: ToastifyToastContainerComponent, decorators: [{
            type: Component,
            args: [{
                    // tslint:disable-next-line:component-selector
                    selector: 'lib-toastify-toast-container',
                    templateUrl: './toastify-toast-container.component.html',
                    styleUrls: ['./toastify-toast-container.component.scss'],
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: function () { return [{ type: i1.ToastService }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { position: [{
                type: Input
            }], transition: [{
                type: Input
            }], autoClose: [{
                type: Input
            }], hideProgressBar: [{
                type: Input
            }], pauseOnHover: [{
                type: Input
            }], pauseOnVisibilityChange: [{
                type: Input
            }], closeOnClick: [{
                type: Input
            }], newestOnTop: [{
                type: Input
            }], preventDuplicates: [{
                type: Input
            }], iconLibrary: [{
                type: Input
            }] } });
var TransitionState;
(function (TransitionState) {
    TransitionState[TransitionState["entering"] = 0] = "entering";
    TransitionState[TransitionState["noTransition"] = 1] = "noTransition";
    TransitionState[TransitionState["exiting"] = 2] = "exiting";
})(TransitionState || (TransitionState = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9hc3RpZnktdG9hc3QtY29udGFpbmVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2FuZ3VsYXItdG9hc3RpZnkvc3JjL2xpYi90b2FzdGlmeS10b2FzdC1jb250YWluZXIvdG9hc3RpZnktdG9hc3QtY29udGFpbmVyLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2FuZ3VsYXItdG9hc3RpZnkvc3JjL2xpYi90b2FzdGlmeS10b2FzdC1jb250YWluZXIvdG9hc3RpZnktdG9hc3QtY29udGFpbmVyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLHVCQUF1QixFQUFFLGlCQUFpQixFQUE0QixNQUFNLGVBQWUsQ0FBQztBQUMvSCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFFaEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7Ozs7QUFTMUMsTUFBTSxPQUFPLCtCQUErQjtJQWtCMUMsWUFBb0IsYUFBMkIsRUFBVSxHQUFzQjtRQUEzRCxrQkFBYSxHQUFiLGFBQWEsQ0FBYztRQUFVLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBakI5RCx3QkFBbUIsR0FBRyxHQUFHLENBQUM7UUFFbEMsYUFBUSxHQUE4RCxXQUFXLENBQUM7UUFDbEYsZUFBVSxHQUF5QyxRQUFRLENBQUM7UUFDNUQsY0FBUyxHQUFHLElBQUksQ0FBQztRQUNqQixvQkFBZSxHQUFHLEtBQUssQ0FBQztRQUN4QixpQkFBWSxHQUFHLElBQUksQ0FBQztRQUNwQiw0QkFBdUIsR0FBRyxJQUFJLENBQUM7UUFDL0IsaUJBQVksR0FBRyxJQUFJLENBQUM7UUFDcEIsZ0JBQVcsR0FBRyxLQUFLLENBQUM7UUFDcEIsc0JBQWlCLEdBQUcsS0FBSyxDQUFDO1FBQzFCLGdCQUFXLEdBQXlD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ZURldGVjdGlvblN0cmF0ZWd5LCBDaGFuZ2VEZXRlY3RvclJlZiwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBUb2FzdFNlcnZpY2UgfSBmcm9tICcuLi90b2FzdC5zZXJ2aWNlJztcbmltcG9ydCB7IFRvYXN0IH0gZnJvbSAnLi4vdG9hc3QnO1xuaW1wb3J0IHsgVG9hc3RUeXBlIH0gZnJvbSAnLi4vdG9hc3QtdHlwZSc7XG5cbkBDb21wb25lbnQoe1xuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6Y29tcG9uZW50LXNlbGVjdG9yXG4gIHNlbGVjdG9yOiAnbGliLXRvYXN0aWZ5LXRvYXN0LWNvbnRhaW5lcicsXG4gIHRlbXBsYXRlVXJsOiAnLi90b2FzdGlmeS10b2FzdC1jb250YWluZXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi90b2FzdGlmeS10b2FzdC1jb250YWluZXIuY29tcG9uZW50LnNjc3MnXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG59KVxuZXhwb3J0IGNsYXNzIFRvYXN0aWZ5VG9hc3RDb250YWluZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG4gIHByaXZhdGUgcmVhZG9ubHkgdHJhbnNpdGlvbkR1cmF0aW9ucyA9IDQwMDtcblxuICBASW5wdXQoKSBwb3NpdGlvbjogJ3RvcC1sZWZ0JyB8ICd0b3AtcmlnaHQnIHwgJ2JvdHRvbS1yaWdodCcgfCAnYm90dG9tLWxlZnQnID0gJ3RvcC1yaWdodCc7XG4gIEBJbnB1dCgpIHRyYW5zaXRpb246ICdib3VuY2UnIHwgJ3NsaWRlJyB8ICd6b29tJyB8ICdmbGlwJyA9ICdib3VuY2UnO1xuICBASW5wdXQoKSBhdXRvQ2xvc2UgPSA1MDAwO1xuICBASW5wdXQoKSBoaWRlUHJvZ3Jlc3NCYXIgPSBmYWxzZTtcbiAgQElucHV0KCkgcGF1c2VPbkhvdmVyID0gdHJ1ZTtcbiAgQElucHV0KCkgcGF1c2VPblZpc2liaWxpdHlDaGFuZ2UgPSB0cnVlO1xuICBASW5wdXQoKSBjbG9zZU9uQ2xpY2sgPSB0cnVlO1xuICBASW5wdXQoKSBuZXdlc3RPblRvcCA9IGZhbHNlO1xuICBASW5wdXQoKSBwcmV2ZW50RHVwbGljYXRlcyA9IGZhbHNlO1xuICBASW5wdXQoKSBpY29uTGlicmFyeTogJ21hdGVyaWFsJyB8ICdmb250LWF3ZXNvbWUnIHwgJ25vbmUnID0gJ25vbmUnO1xuXG4gIFRvYXN0VHlwZSA9IFRvYXN0VHlwZTtcbiAgdG9hc3RzID0gbmV3IEFycmF5PFRvYXN0PigpO1xuICB0b2FzdFRyYW5zaXRpb25EaWN0ID0ge307XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBfdG9hc3RTZXJ2aWNlOiBUb2FzdFNlcnZpY2UsIHByaXZhdGUgX2NkOiBDaGFuZ2VEZXRlY3RvclJlZikgeyB9XG5cbiAgbmdPbkNoYW5nZXMoKTogdm9pZCB7XG4gICAgdGhpcy5fY2QubWFya0ZvckNoZWNrKCk7XG4gIH1cblxuICBkaXNtaXNzKHRvYXN0OiBUb2FzdCk6IHZvaWQge1xuICAgIHRoaXMudG9hc3RUcmFuc2l0aW9uRGljdFt0b2FzdC5pZF0gPSBUcmFuc2l0aW9uU3RhdGUuZXhpdGluZztcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy50b2FzdHMuaW5kZXhPZih0b2FzdCk7XG4gICAgICB0aGlzLnRvYXN0cy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgdGhpcy5fY2QubWFya0ZvckNoZWNrKCk7XG4gICAgfSwgdGhpcy50cmFuc2l0aW9uRHVyYXRpb25zKTtcbiAgfVxuXG4gIGdldENsYXNzKHRvYXN0OiBUb2FzdCk6IHN0cmluZyB7XG4gICAgbGV0IGJhc2UgPSBgdG9hc3QgdG9hc3QtLSR7VG9hc3RUeXBlW3RvYXN0LnR5cGVdfSBgO1xuICAgIGNvbnN0IHN0YXRlID0gdGhpcy50b2FzdFRyYW5zaXRpb25EaWN0W3RvYXN0LmlkXTtcbiAgICBpZiAoc3RhdGUgPT09IFRyYW5zaXRpb25TdGF0ZS5lbnRlcmluZykge1xuICAgICAgYmFzZSArPSBgJHt0aGlzLnRyYW5zaXRpb259LWVudGVyICR7dGhpcy50cmFuc2l0aW9ufS1lbnRlci0tJHt0aGlzLnBvc2l0aW9ufWA7XG4gICAgfSBlbHNlIGlmIChzdGF0ZSA9PT0gVHJhbnNpdGlvblN0YXRlLmV4aXRpbmcpIHtcbiAgICAgIGJhc2UgKz0gYCR7dGhpcy50cmFuc2l0aW9ufS1leGl0ICR7dGhpcy50cmFuc2l0aW9ufS1leGl0LS0ke3RoaXMucG9zaXRpb259YDtcbiAgICB9XG5cbiAgICByZXR1cm4gYmFzZTtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuX3RvYXN0U2VydmljZS5kaXNtaXNzQWxsRXZlbnQuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIHRoaXMudG9hc3RzID0gbmV3IEFycmF5PFRvYXN0PigpO1xuICAgICAgdGhpcy5fY2QubWFya0ZvckNoZWNrKCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLl90b2FzdFNlcnZpY2UudG9hc3RBZGRlZEV2ZW50LnN1YnNjcmliZSgodG9hc3Q6IFRvYXN0KSA9PiB0aGlzLmhhbmRsZVRvYXN0QWRkZWRFdmVudCh0b2FzdCkpO1xuICB9XG5cbiAgaGFuZGxlVG9hc3RBZGRlZEV2ZW50KHRvYXN0OiBUb2FzdCk6IHZvaWQge1xuICAgIC8vIElmIFwicHJldmVudER1cGxpY2F0ZXNcIiBpcyBlbmFibGVkLCB0b2FzdCBpcyBub3QgYWRkZWQgaWYgb25lIHRvYXN0IHdpdGggc2FtZSBtZXNzYWdlIGV4aXN0c1xuICAgIC8vIFRoZSBvbmx5IHRoaW5nIHRvIGRvIGlzIHRvIHVwZGF0ZSB0aGUgdG9hc3QgdGltZSB0byBrZWVwIGl0IHZpc2libGVcbiAgICBpZih0aGlzLnByZXZlbnREdXBsaWNhdGVzID09PSB0cnVlKSB7XG4gICAgICBjb25zdCBzYW1lVG9hc3Q6IFRvYXN0ID0gdGhpcy50b2FzdHMuZmluZCgoZXhpc3RpbmdUb2FzdCkgPT4gZXhpc3RpbmdUb2FzdC5tZXNzYWdlID09PSB0b2FzdC5tZXNzYWdlKTtcbiAgICAgIGlmIChzYW1lVG9hc3QpIHtcbiAgICAgICAgc2FtZVRvYXN0LiRyZXNldFRvYXN0Lm5leHQoKTtcbiAgICAgICAgdGhpcy5fY2QubWFya0ZvckNoZWNrKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBBZGQgbmV3IHRvYXN0IHRyYW5zaXRpb25cbiAgICB0aGlzLnRvYXN0VHJhbnNpdGlvbkRpY3RbdG9hc3QuaWRdID0gVHJhbnNpdGlvblN0YXRlLmVudGVyaW5nO1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy50b2FzdFRyYW5zaXRpb25EaWN0W3RvYXN0LmlkXSA9IFRyYW5zaXRpb25TdGF0ZS5ub1RyYW5zaXRpb247XG4gICAgICB0aGlzLl9jZC5tYXJrRm9yQ2hlY2soKTtcbiAgICB9LCB0aGlzLnRyYW5zaXRpb25EdXJhdGlvbnMpO1xuXG4gICAgLy8gQWRkIG5ldyB0b2FzdFxuICAgIGlmICh0aGlzLm5ld2VzdE9uVG9wKSB7XG4gICAgICB0aGlzLnRvYXN0cy51bnNoaWZ0KHRvYXN0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy50b2FzdHMucHVzaCh0b2FzdCk7XG4gICAgfVxuICAgIHRoaXMuX2NkLm1hcmtGb3JDaGVjaygpO1xuICB9XG59XG5cbmVudW0gVHJhbnNpdGlvblN0YXRlIHtcbiAgZW50ZXJpbmcsXG4gIG5vVHJhbnNpdGlvbixcbiAgZXhpdGluZ1xufVxuIiwiPGRpdiBjbGFzcz1cInRvYXN0LWNvbnRhaW5lciB0b2FzdC1jb250YWluZXItLXt7cG9zaXRpb259fVwiPlxuICAgIDxsaWItdG9hc3RpZnktdG9hc3QgKm5nRm9yPVwibGV0IHRvYXN0IG9mIHRvYXN0c1wiIFtjbGFzc109XCJnZXRDbGFzcyh0b2FzdClcIiBzdHlsZT1cImFuaW1hdGlvbi1maWxsLW1vZGU6IGJvdGg7IGFuaW1hdGlvbi1kdXJhdGlvbjogMC43NXNcIlxuICAgICAgICBbYXV0b0Nsb3NlXT1cImF1dG9DbG9zZVwiIFt0b2FzdF09XCJ0b2FzdFwiIChkaXNtaXNzRXZlbnQpPVwiZGlzbWlzcyh0b2FzdClcIiBbaGlkZVByb2dyZXNzQmFyXT1cImhpZGVQcm9ncmVzc0JhclwiIFtwYXVzZU9uSG92ZXJdPVwicGF1c2VPbkhvdmVyXCJcbiAgICAgICAgW3BhdXNlT25WaXNpYmlsaXR5Q2hhbmdlXT1cInBhdXNlT25WaXNpYmlsaXR5Q2hhbmdlXCIgW2Nsb3NlT25DbGlja109XCJjbG9zZU9uQ2xpY2tcIiBbaWNvbkxpYnJhcnldPVwiaWNvbkxpYnJhcnlcIj5cbiAgICA8L2xpYi10b2FzdGlmeS10b2FzdD5cbjwvZGl2PiJdfQ==